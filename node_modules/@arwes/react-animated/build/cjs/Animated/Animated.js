"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Animated = void 0;
const react_1 = require("react");
const react_tools_1 = require("@arwes/react-tools");
const react_animator_1 = require("@arwes/react-animator");
const animated_1 = require("@arwes/animated");
const index_js_1 = require("../useAnimated/index.js");
const AnimatedComponent = (props) => {
    const { as: asProvided, animated, className, style, elementRef: externalElementRef, hideOnExited = true, hideOnEntered, onTransition, ...otherProps } = props;
    const animator = (0, react_animator_1.useAnimator)();
    const as = (0, react_1.useMemo)(() => asProvided || 'div', []);
    const elementRef = (0, react_1.useRef)(null);
    (0, index_js_1.useAnimated)(elementRef, animated, {
        renderInitials: false,
        hideOnExited,
        hideOnEntered,
        onTransition
    });
    const animatedSettingsListReceived = Array.isArray(animated) ? animated : [animated];
    const animatedSettingsList = animatedSettingsListReceived
        .map((item) => (typeof item === 'string' || Array.isArray(item) ? undefined : item))
        .filter(Boolean);
    let initialAttributes;
    if (animator) {
        initialAttributes = animatedSettingsList
            .map((item) => (item ? item.initialAttributes : undefined))
            .reduce((total, item) => ({ ...total, ...item }), {});
    }
    let dynamicStyles;
    if (animator) {
        dynamicStyles = animatedSettingsList
            .map((item) => (item ? item.initialStyle : undefined))
            .filter(Boolean)
            .map((styles) => (0, animated_1.formatAnimatedCSSProps)(styles))
            .reduce((total, item) => ({ ...total, ...item }), {});
    }
    return (0, react_1.createElement)(as, {
        ...otherProps,
        ...initialAttributes,
        ref: (0, react_tools_1.mergeRefs)(externalElementRef, elementRef),
        className,
        style: {
            ...style,
            visibility: animator &&
                ((hideOnExited && animator.node.state === 'exited') ||
                    (hideOnEntered && animator.node.state === 'entered'))
                ? 'hidden'
                : '',
            ...dynamicStyles
        }
    });
};
exports.Animated = (0, react_tools_1.memo)(AnimatedComponent);
